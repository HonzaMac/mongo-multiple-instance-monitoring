<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Monitoring dashboard for multiple mongodb instances</title>
    <script type="text/javascript">
        var urlParams;
        (window.onpopstate = function () {
            var match,
                    pl     = /\+/g,  // Regex for replacing addition symbol with a space
                    search = /([^&=]+)=?([^&]*)/g,
                    decode = function (s) { return decodeURIComponent(s.replace(pl, " ")); },
                    query  = window.location.search.substring(1);

            urlParams = {
                host: 'localhost',
                port: '9900'
            };
            while (match = search.exec(query))
                urlParams[decode(match[1])] = decode(match[2]);
        })();


        function WebSocketTest(host, port) {
            if ("WebSocket" in window) {
                console.log("WebSocket is supported by your Browser");

                // Let us open a web socket
                var url = "ws://" + host + ":" + port +"/echo";
                var ws = new WebSocket(url);

                ws.onopen = function () {
                    // Web Socket is connected, send data using send()
//                    ws.send("Message to send");
//                    console.log("Message is sent...");
                };

                ws.onmessage = function (evt) {
                    var received_msg = evt.data;
                    console.log("Message is received...");
                    document.getElementById('events').innerHTML += received_msg + "<br>";
                };

                ws.onerror = function (evt) {
                    console.log(evt);
                    document.getElementById('errors').innerHTML = "Error in Websocket occured. See console log for more info";
                };

                ws.onclose = function (evt) {
                    console.log(evt);
                    // websocket is closed.
                    document.getElementById('errors').innerHTML = "Connection to <strong>" + url + "</strong> is closed.";
//                    setTimeout(WebSocketTest(host, port), 5000);
                };
            }

            else {
                // The browser doesn't support WebSocket
                alert("WebSocket NOT supported by your Browser!");
            }
        }

    </script>
    <script>
        WebSocketTest(urlParams['host'], urlParams['port']);
    </script>
</head>
<body>

<div id="errors"></div>

<div id="events"></div>
</body>
</html>